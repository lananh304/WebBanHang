if (self.CavalryLogger) { CavalryLogger.start_js(["ZWoRU"]); }

__d("XAsyncAddToCollectionMenuController",["XController"],(function(a,b,c,d,e,f){e.exports=b("XController").create("/saved/add_to_collection/menu/",{element_id:{type:"String"},save_context_token:{type:"String"},story_token:{type:"String"}})}),null);
__d("MSavedAddToCollectionMenu",["CSS","DOM","MLegacyDataStore","MParent","MRequest","MTouchClick","Stratcom","SubscriptionsHandler","XAsyncAddToCollectionMenuController","$"],(function(a,b,c,d,e,f){__p&&__p();var g,h,i,j,k,l;function m(a){a=b("MParent").bySigil(a,"story-popup-metadata");return a}function n(){__p&&__p();var a=this.getCausalElement(),c=b("MLegacyDataStore").get(a),d=m(a),e=b("XAsyncAddToCollectionMenuController").getURIBuilder().getURI();e=new(b("MRequest"))(e);j&&b("CSS").show(j);k&&b("CSS").hide(k);l&&b("CSS").hide(l);g=d;e.setMethod("POST");e.setData({element_id:a.id,save_context_token:c.saveContextToken,story_token:c.storyToken});e.listen("error",function(a){j&&b("CSS").hide(j),a=="status=0"?(k&&b("CSS").show(k),l&&b("CSS").hide(l)):(l&&b("CSS").show(l),k&&b("CSS").hide(k))});e.send()}function o(){i&&(i.release(),i=null),h=null,j=null,k=null,l=null}function p(){if(h){var a=h.getContentRoot();j=b("DOM").find(a,"div","loadingWrapper");k=b("DOM").find(a,"div","noConnectionWrapper");l=b("DOM").find(a,"div","requestErrorWrapper")}}function a(a){h&&(h.destroy(),o()),h=a,p(),i=new(b("SubscriptionsHandler"))(),i.addSubscriptions(h.addListener("beforeshow",n,h),b("Stratcom").listen("m:page:unload",null,o))}function q(a,c){if(!h||!h.isShown()||c)return;h.hide();c=m(a);g==c&&b("MTouchClick").click(a)}function c(a,c){b("DOM").replace(b("$")(c),a),q(a,!1)}e.exports={init:a,replaceLoadingMenu:c}}),null);